<html>
<head>
  <title>Philco Radio</title>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
  <style media="screen" type="text/css">
  html,
  body {
    margin:0;
    padding:0;
    background:#fff;
    width: 320px;
    height: 548px;
    overflow-x: hidden;
    overflow-y: hidden;
  }
  #station{
    margin-left: 29px;
  }
  #volumedown { 
    margin-left: 29px;
  } 
  #volumemute { 
    margin-left: 7px; 
    margin-right: 7px;
  }
  .volume { 
    margin-top: 11px;
  }
  #volumebar { 
    margin-top: 11px;
    margin-left: 29px;
    width: 262px;
    height: 34px;
  }
  .dark {
    -webkit-filter: brightness(50%);
  }
</style>
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io.connect('http://philco.local:8080');

  // on connection to server, request the current station
  socket.on('connect', function() {
    socket.emit('getCurrentStation');
    socket.emit('getVolume');
  });

  socket.on('updatestation', function (new_station) {
    var station = document.getElementById('station');
    
    station.className = '';

    if(new_station == 'kexp')
    {
      station.src='btn_kexp.png';
    }
    else if(new_station == 'npr')
    {
      station.src='btn_npr.png';
    }
    else if(new_station == 'kids')
    {
      station.src='btn_kids.png';
    }
    else // shairport
    {
      station.src='btn_shair.png';
    }
  });

  socket.on('updatevolume', function (volume)
  {
    var buttons=document.getElementsByClassName("volume");
    for (var i = 0; i < buttons.length; ++i) {
      var btn = buttons[i];  
      btn.className='volume';
    }

    var c=document.getElementById("volumebar");
    var ctx=c.getContext("2d");
    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle="#740c15";
    ctx.fillRect(0,0,(volume/31)*c.width,c.height);
  });

  function toggleStation()
  {
    var station = document.getElementById('station');
    station.className = 'dark';
    socket.emit('getNextStation', 'npr');
  }

  function blockMove()
  {
    event.preventDefault();
  }

  function setVol(value, button)
  {
    var theButton = document.getElementById(button);
    
    theButton.className='volume dark';
    if( value == -1)
      socket.emit('setVolume', '1-');
    else if(value == 1)
      socket.emit('setVolume', '1+');
    else
      socket.emit('setVolume', '0');
  }
</script>
</head>
<body onload="window.top.scrollTo(0,1);" ontouchmove="blockMove();"> 
  <div id="container">
    <div id="body">
      <img id='header' src='header.png'/>
      <img id='station' src='btn_shair.png' onclick="toggleStation();"/>
      <img id='volumedown' class='volume' src='btn_vol_down.png' onclick="setVol(-1,'volumedown');"/>
      <img id='volumemute' class='volume' src='btn_vol_mute.png' onclick="setVol(0,'volumemute');"/>
      <img id='volumeup' class='volume' src='btn_vol_up.png' onclick="setVol(1,'volumeup');"/>
      <canvas id="volumebar"></canvas>
    </div>
  </div>
</body>
</html>
